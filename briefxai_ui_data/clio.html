<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clio - Interactive Conversation Analysis</title>
    <link rel="stylesheet" href="static/clio.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <!-- Top Navigation -->
    <nav class="clio-nav">
        <div class="nav-left">
            <div class="logo">
                <span class="logo-icon">üéØ</span>
                <span class="logo-text">Clio Analysis</span>
            </div>
            <div class="nav-tabs">
                <button class="nav-tab active" data-view="map">Map View</button>
                <button class="nav-tab" data-view="patterns">Patterns</button>
                <button class="nav-tab" data-view="timeline">Timeline</button>
                <button class="nav-tab" data-view="audit">Audit</button>
            </div>
        </div>
        <div class="nav-right">
            <div class="search-box">
                <input type="text" placeholder="Search clusters..." id="cluster-search">
                <button class="search-btn">üîç</button>
            </div>
            <button class="btn-icon" id="settings-btn">‚öôÔ∏è</button>
            <button class="btn-icon" id="help-btn">‚ùì</button>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="clio-container">
        <!-- Left Panel - Hierarchy Explorer -->
        <aside class="side-panel left-panel">
            <div class="panel-header">
                <h3>Cluster Hierarchy</h3>
                <button class="btn-sm" id="collapse-all">‚àí</button>
                <button class="btn-sm" id="expand-all">+</button>
            </div>
            <div class="hierarchy-tree" id="hierarchy-tree">
                <!-- Tree structure will be rendered here -->
            </div>
            
            <div class="panel-section">
                <h4>Filters</h4>
                <div class="filter-group">
                    <label>Min Size:</label>
                    <input type="range" min="1" max="100" value="10" id="min-size-filter">
                    <span id="min-size-value">10</span>
                </div>
                <div class="filter-group">
                    <label>Sentiment:</label>
                    <select id="sentiment-filter">
                        <option value="all">All</option>
                        <option value="positive">Positive</option>
                        <option value="neutral">Neutral</option>
                        <option value="negative">Negative</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Pattern Type:</label>
                    <select id="pattern-filter">
                        <option value="all">All</option>
                        <option value="recurring">Recurring</option>
                        <option value="emerging">Emerging</option>
                        <option value="anomaly">Anomaly</option>
                    </select>
                </div>
            </div>
            
            <div class="panel-section">
                <h4>Statistics</h4>
                <div class="stat-grid">
                    <div class="stat-item">
                        <span class="stat-label">Total Clusters</span>
                        <span class="stat-value" id="total-clusters">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Conversations</span>
                        <span class="stat-value" id="total-conversations">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Patterns</span>
                        <span class="stat-value" id="total-patterns">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Depth</span>
                        <span class="stat-value" id="hierarchy-depth">0</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Center - Main Visualization -->
        <main class="main-viz">
            <!-- Breadcrumb Navigation -->
            <div class="breadcrumb"></div>
            
            <!-- Visualization Controls -->
            <div class="viz-controls">
                <div class="control-group">
                    <button class="control-btn" id="zoom-in" title="Zoom In">üîç+</button>
                    <button class="control-btn" id="zoom-out" title="Zoom Out">üîç-</button>
                    <button class="control-btn" id="reset-view" title="Reset View">üîÑ</button>
                    <button class="control-btn" id="fullscreen" title="Fullscreen">‚õ∂</button>
                </div>
                <div class="control-group">
                    <label>Layout:</label>
                    <select id="layout-select">
                        <option value="force">Force-Directed</option>
                        <option value="radial">Radial</option>
                        <option value="tree">Tree</option>
                        <option value="pack">Circle Pack</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Color by:</label>
                    <select id="color-select">
                        <option value="sentiment">Sentiment</option>
                        <option value="size">Size</option>
                        <option value="depth">Depth</option>
                        <option value="concern">Concern Level</option>
                    </select>
                </div>
            </div>
            
            <!-- Main Visualization Canvas -->
            <div id="clio-visualization" class="viz-canvas">
                <!-- D3.js visualization will be rendered here -->
            </div>
            
            <!-- Mini Map -->
            <div class="mini-map" id="mini-map">
                <div class="mini-map-viewport"></div>
            </div>
        </main>

        <!-- Right Panel - Details & Insights -->
        <aside class="side-panel right-panel">
            <div class="panel-header">
                <h3>Cluster Details</h3>
                <button class="btn-sm" id="close-details">√ó</button>
            </div>
            
            <div id="cluster-details" class="cluster-details">
                <div class="detail-placeholder">
                    <p>Select a cluster to view details</p>
                </div>
            </div>
            
            <div class="panel-section">
                <h4>Patterns</h4>
                <div id="pattern-list" class="pattern-list">
                    <!-- Patterns will be displayed here -->
                </div>
            </div>
            
            <div class="panel-section">
                <h4>Sample Conversations</h4>
                <div id="sample-conversations" class="conversation-samples">
                    <!-- Sample conversations will be displayed here -->
                </div>
            </div>
            
            <div class="panel-section">
                <h4>Actions</h4>
                <div class="action-buttons">
                    <button class="btn-primary" id="investigate-btn">üîç Investigate</button>
                    <button class="btn-secondary" id="export-btn">üì• Export</button>
                    <button class="btn-secondary" id="annotate-btn">üìù Annotate</button>
                    <button class="btn-secondary" id="share-btn">üîó Share</button>
                </div>
            </div>
            
            <div class="panel-section">
                <h4>Privacy Audit</h4>
                <div class="privacy-audit">
                    <div class="audit-item safe">
                        <span class="audit-icon">‚úÖ</span>
                        <span>No PII detected</span>
                    </div>
                    <div class="audit-summary">
                        <p>Last audited: <span id="audit-time">Just now</span></p>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Status Bar -->
    <footer class="status-bar">
        <div class="status-left">
            <span class="status-item">
                <span class="status-icon">üìä</span>
                Analysis Status: <span id="analysis-status">Ready</span>
            </span>
        </div>
        <div class="status-center">
            <span class="status-item">Zoom: <span id="zoom-level">100%</span></span>
            <span class="status-separator">|</span>
            <span class="status-item">Selected: <span id="selected-count">0</span></span>
            <span class="status-separator">|</span>
            <span class="status-item">Visible: <span id="visible-count">0</span></span>
        </div>
        <div class="status-right">
            <span class="status-item">Cost: $<span id="analysis-cost">0.00</span></span>
            <span class="status-separator">|</span>
            <span class="status-item success">‚óè Connected</span>
        </div>
    </footer>

    <!-- Pattern Discovery Modal -->
    <div id="pattern-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Pattern Discovery</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="pattern-discovery">
                    <div class="discovery-controls">
                        <label>Pattern Type:</label>
                        <select id="pattern-type">
                            <option value="linguistic">Linguistic Patterns</option>
                            <option value="temporal">Temporal Patterns</option>
                            <option value="behavioral">Behavioral Patterns</option>
                            <option value="sentiment">Sentiment Patterns</option>
                        </select>
                        
                        <label>Threshold:</label>
                        <input type="range" min="0" max="100" value="30" id="pattern-threshold">
                        <span id="threshold-value">30%</span>
                        
                        <button class="btn-primary" id="discover-patterns">Discover Patterns</button>
                    </div>
                    
                    <div class="discovered-patterns" id="discovered-patterns">
                        <!-- Discovered patterns will be shown here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Clio Navigation Guide</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="help-content">
                    <h3>Keyboard Shortcuts</h3>
                    <ul class="shortcuts-list">
                        <li><kbd>Click</kbd> - Select cluster</li>
                        <li><kbd>Double-click</kbd> - Drill into cluster</li>
                        <li><kbd>Esc</kbd> - Go up one level</li>
                        <li><kbd>+/-</kbd> - Zoom in/out</li>
                        <li><kbd>R</kbd> - Reset view</li>
                        <li><kbd>F</kbd> - Toggle fullscreen</li>
                        <li><kbd>Space</kbd> - Pause/resume animation</li>
                    </ul>
                    
                    <h3>Interaction Patterns</h3>
                    <p><strong>Overview First:</strong> Start with the high-level view of all clusters</p>
                    <p><strong>Zoom & Filter:</strong> Use controls to focus on areas of interest</p>
                    <p><strong>Details on Demand:</strong> Click clusters for detailed information</p>
                    
                    <h3>Visual Encoding</h3>
                    <ul>
                        <li>üî¥ Red clusters - Negative sentiment</li>
                        <li>üü° Yellow clusters - Neutral sentiment</li>
                        <li>üü¢ Green clusters - Positive sentiment</li>
                        <li>Size represents conversation count</li>
                        <li>Opacity indicates confidence level</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Scripts -->
    <script src="static/clio-viz.js"></script>
    <script>
        // Initialize Clio visualization
        document.addEventListener('DOMContentLoaded', () => {
            // Additional initialization for modals and controls
            
            // Help modal
            document.getElementById('help-btn').addEventListener('click', () => {
                document.getElementById('help-modal').style.display = 'block';
            });
            
            // Close modals
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.target.closest('.modal').style.display = 'none';
                });
            });
            
            // Filter controls
            document.getElementById('min-size-filter').addEventListener('input', (e) => {
                document.getElementById('min-size-value').textContent = e.target.value;
                if (window.clioViz) {
                    window.clioViz.applyFilters();
                }
            });
            
            // Layout change
            document.getElementById('layout-select').addEventListener('change', (e) => {
                if (window.clioViz) {
                    window.clioViz.changeLayout(e.target.value);
                }
            });
            
            // Color scheme change
            document.getElementById('color-select').addEventListener('change', (e) => {
                if (window.clioViz) {
                    window.clioViz.changeColorScheme(e.target.value);
                }
            });
            
            // Search functionality
            document.getElementById('cluster-search').addEventListener('keyup', (e) => {
                if (e.key === 'Enter' && window.clioViz) {
                    window.clioViz.searchClusters(e.target.value);
                }
            });
        });
    </script>
</body>
</html>